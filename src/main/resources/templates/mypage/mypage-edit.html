<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>프로필 수정</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/mypage.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    <script th:src="@{/js/mypage-edit.js}" defer></script>
</head>
<body>

<div th:replace="fragments/header :: header"></div>

<div class="container">
    <nav class="breadcrumb">
        <a th:href="@{/mypage}">마이페이지</a> &gt; <span>프로필 수정</span>
    </nav>

    <h1>프로필 수정</h1>

    <!-- 🔹 프로필 이미지 업로드 영역 -->
    <div class="form-box">
        <h3>프로필 이미지</h3>
        <div class="upload-section">
            <div class="image-preview">
                <img th:if="${user.profileImageUrl != null}" th:src="@{${user.profileImageUrl}}" alt="프로필" />
                <img th:if="${user.profileImageUrl == null}" src="/img/진욱.svg" alt="기본 이미지" />

                <form th:action="@{/mypage/profile/image/delete}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn-delete">이미지 삭제</button>
                </form>
            </div>

            <form th:action="@{/mypage/profile/image}" method="post" enctype="multipart/form-data">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="upload-box" id="dropArea">
                    <p>이미지를 드래그하거나 클릭하여 업로드<br>(JPG, JPEG, PNG만 가능)</p>
                    <input type="file" id="imageInput" name="imageFile" accept="image/*" hidden>
                    <button type="button" id="uploadTrigger" class="btn-upload">이미지 업로드</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 🔹 사용자 정보 수정 영역 -->
    <form th:action="@{/mypage/edit}" method="post" class="form-box">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <h3>개인 정보</h3>

        <div class="form-group">
            <label for="name">이름</label>
            <input type="text" id="name" name="name" th:value="${user.name}" required>
        </div>

        <div class="form-group">
            <label for="job">직군</label>
            <select id="job" name="job" required>
                <option disabled selected>직군을 선택하세요</option>
                <option th:value="백엔드" th:selected="${user.job == '백엔드'}">백엔드</option>
                <option th:value="프론트엔드" th:selected="${user.job == '프론트엔드'}">프론트엔드</option>
                <option th:value="AI" th:selected="${user.job == 'AI'}">AI</option>
                <option th:value="DevOps" th:selected="${user.job == 'DevOps'}">DevOps</option>
                <option th:value="기획" th:selected="${user.job == '기획'}">기획</option>
            </select>
        </div>

        <div class="form-group">
            <label for="careerLevel">경력 수준</label>
            <select id="careerLevel" name="careerLevel" required>
                <option disabled selected>경력 수준을 선택하세요</option>
                <option th:value="주니어" th:selected="${user.careerLevel == '주니어'}">주니어</option>
                <option th:value="미들" th:selected="${user.careerLevel == '미들'}">미들</option>
                <option th:value="시니어" th:selected="${user.careerLevel == '시니어'}">시니어</option>
                <option th:value="리드" th:selected="${user.careerLevel == '리드'}">리드</option>
            </select>
        </div>

        <div class="form-actions">
            <button type="submit" class="save-btn">변경사항 저장</button>
            <a th:href="@{/mypage}" class="cancel-btn">취소</a>
        </div>
    </form>
</div>

</body>
</html>
